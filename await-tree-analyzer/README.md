# Explanation of Commit

In this commit, we simulate a scenario where a particularly slow executor blocks the system. Specifically, we pause one of the join actors (actor_id 68, fragment_id 17) for 200 seconds after the cluster has been running for 300 seconds. Since this is purely for simulation purposes, the code uses some hardcoded values to manually introduce the blocking behavior, which helps avoid the complexity of setting up a full test environment.

The changes in this commit are only applicable to the data and tables generated by the scripts within this directory.

This setup simulates a situation where an upstream actor is blocked by a barrier and cannot read data, while its downstream counterpart is also blocked as it waits for the slow actor to produce data.

# Start
``` shell
# please kill you existing cluster first.
./await-tree-analyzer/run.sh
```

# Analyze the bottleneck

When you observe high barrier interval, run the following command:
```
RW_META_ADDR=http://127.0.0.1:5690 .risingwave/bin/risingwave/risectl await-tree-analyze
```

The barrier interval starts to increase after about 5 minutes after you starting the cluster.

Ideally, you should be able to see some output like this:

```
Actor 68: `CREATE MATERIALIZED VIEW mv_join_abc AS SELECT a.a_id, c.c_category, COUNT(*) AS total_rows, SUM(c.c_amount) AS total_amount FROM table_a AS a JOIN table_b AS b ON a.a_id = b.b_key JOIN table_c AS c ON c.c_id = (b.b_val % 10) GROUP BY a.a_id, c.c_category` [364.478s]  <== current
  Epoch 8250658946023424 [!!! 64.446s]
    HashJoin 4400000007 [!!! 64.447s]
      hash_join_sleep [0.921s]
[Detached 3]
  Merge 4400000006 [!!! 64.447s]
```